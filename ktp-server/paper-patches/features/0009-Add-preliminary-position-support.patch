From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Bjarne Koll <git@lynxplay.dev>
Date: Tue, 20 May 2025 01:36:29 +0200
Subject: [PATCH] Add preliminary position support

The paper introduced position type is currently highly experimental
however, ktp and its consuming plugins aim to use this API.
For this, this patch adds fundamental support to the API for position
usage.

diff --git a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
index c677be0e292b59a6d7dbadfa53833a514f9ec30d..db16fb3a8c3e4419bbbd461e790b98ffcae8b9b8 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftWorld.java
@@ -97,6 +97,7 @@ import org.bukkit.NamespacedKey;
 import org.bukkit.Particle;
 import org.bukkit.Raid;
 import org.bukkit.Sound;
+import org.bukkit.SoundCategory;
 import org.bukkit.TreeType;
 import org.bukkit.World;
 import org.bukkit.WorldBorder;
@@ -2071,4 +2072,20 @@ public class CraftWorld extends CraftRegionAccessor implements World {
     }
     // KTP end - expose low level steering interceptors
 
+    // KTP start - preliminary position support
+    @Override
+    public void playSound(@org.jetbrains.annotations.NotNull final io.papermc.paper.math.Position position,
+                          @org.jetbrains.annotations.NotNull final Sound sound,
+                          @org.jetbrains.annotations.NotNull final SoundCategory category,
+                          final float volume,
+                          final float pitch) {
+        if (position == null || sound == null || category == null) return;
+
+        double x = position.x();
+        double y = position.y();
+        double z = position.z();
+
+        this.getHandle().playSound(null, x, y, z, CraftSound.bukkitToMinecraft(sound), SoundSource.valueOf(category.name()), volume, pitch);
+    }
+    // KTP end - preliminary position support
 }
diff --git a/src/main/java/org/bukkit/craftbukkit/legacy/MaterialRerouting.java b/src/main/java/org/bukkit/craftbukkit/legacy/MaterialRerouting.java
index 9bc8055c36322c79077af57ab72d5493f5e65b7d..0ddb995a1c40466987f264905360c4847e43c5ed 100644
--- a/src/main/java/org/bukkit/craftbukkit/legacy/MaterialRerouting.java
+++ b/src/main/java/org/bukkit/craftbukkit/legacy/MaterialRerouting.java
@@ -522,6 +522,16 @@ public class MaterialRerouting {
         return MaterialRerouting.transformFromBlockType(regionAccessor.getType(location), version);
     }
 
+    // KTP start - initial position support
+    public static Material getType(RegionAccessor regionAccessor, io.papermc.paper.math.Position location, @InjectPluginVersion ApiVersion version) {
+        return MaterialRerouting.transformFromBlockType(regionAccessor.getType(location), version);
+    }
+
+    public static void setType(RegionAccessor regionAccessor, io.papermc.paper.math.Position location, Material material) {
+        regionAccessor.setType(location, MaterialRerouting.transformToBlockType(material));
+    }
+    // KTP end - initial position support
+
     public static Material getType(RegionAccessor regionAccessor, int x, int y, int z, @InjectPluginVersion ApiVersion version) {
         return MaterialRerouting.transformFromBlockType(regionAccessor.getType(x, y, z), version);
     }
